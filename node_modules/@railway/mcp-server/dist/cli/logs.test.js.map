{"version":3,"file":"logs.test.js","names":[],"sources":["../../src/cli/logs.test.ts"],"sourcesContent":["import { beforeEach, describe, expect, it, vi } from \"vitest\";\nimport { buildLogCommand } from \"./logs\";\n\nvi.mock(\"./version\", () => ({\n  getCliFeatureSupport: vi.fn(),\n}));\n\ndescribe(\"Railway Logs Module\", () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  describe(\"buildLogCommand\", () => {\n    it(\"should build deployment command with lines and filter for v4.9.0+\", async () => {\n      const { getCliFeatureSupport } = await import(\"./version\");\n\n      vi.mocked(getCliFeatureSupport).mockResolvedValue({\n        deployment: {\n          list: true,\n        },\n        logs: {\n          args: {\n            lines: true,\n            filter: true,\n          },\n        },\n      });\n\n      const command = await buildLogCommand({\n        type: \"deployment\",\n        lines: 100,\n        filter: \"error\",\n      });\n\n      expect(command).toBe(\n        'railway logs --deployment --lines 100 --filter \"error\"'\n      );\n    });\n\n    it(\"should build build command with lines and filter for v4.9.0+\", async () => {\n      const { getCliFeatureSupport } = await import(\"./version\");\n\n      vi.mocked(getCliFeatureSupport).mockResolvedValue({\n        deployment: {\n          list: true,\n        },\n        logs: {\n          args: {\n            lines: true,\n            filter: true,\n          },\n        },\n      });\n\n      const command = await buildLogCommand({\n        type: \"build\",\n        lines: 200,\n        filter: \"warning\",\n      });\n\n      expect(command).toBe(\n        'railway logs --build --lines 200 --filter \"warning\"'\n      );\n    });\n\n    it(\"should default to 500 lines when json is false\", async () => {\n      const { getCliFeatureSupport } = await import(\"./version\");\n\n      vi.mocked(getCliFeatureSupport).mockResolvedValue({\n        deployment: {\n          list: true,\n        },\n        logs: {\n          args: {\n            lines: true,\n            filter: true,\n          },\n        },\n      });\n\n      const command = await buildLogCommand({ type: \"deployment\" });\n\n      expect(command).toBe(\"railway logs --deployment --lines 500\");\n    });\n\n    it(\"should default to 100 lines when json is true\", async () => {\n      const { getCliFeatureSupport } = await import(\"./version\");\n\n      vi.mocked(getCliFeatureSupport).mockResolvedValue({\n        deployment: {\n          list: true,\n        },\n        logs: {\n          args: {\n            lines: true,\n            filter: true,\n          },\n        },\n      });\n\n      const command = await buildLogCommand({ type: \"deployment\", json: true });\n\n      expect(command).toBe(\"railway logs --deployment --json --lines 100\");\n      expect(command).toBe(\"railway logs --deployment --json --lines 100\");\n    });\n\n    it(\"should not include lines/filter for older CLI versions\", async () => {\n      const { getCliFeatureSupport } = await import(\"./version\");\n\n      vi.mocked(getCliFeatureSupport).mockResolvedValue({\n        deployment: {\n          list: true,\n        },\n        logs: {\n          args: {\n            lines: false,\n            filter: false,\n          },\n        },\n      });\n\n      const command = await buildLogCommand({\n        type: \"deployment\",\n        lines: 100, // Should be ignored\n        filter: \"error\", // Should be ignored\n      });\n\n      expect(command).toBe(\"railway logs --deployment\");\n    });\n\n    it(\"should include deploymentId when provided\", async () => {\n      const { getCliFeatureSupport } = await import(\"./version\");\n\n      vi.mocked(getCliFeatureSupport).mockResolvedValue({\n        deployment: {\n          list: true,\n        },\n        logs: {\n          args: {\n            lines: true,\n            filter: true,\n          },\n        },\n      });\n\n      const command = await buildLogCommand({\n        type: \"deployment\",\n        deploymentId: \"deploy-123\",\n      });\n\n      expect(command).toBe(\"railway logs --deployment --lines 500 deploy-123\");\n    });\n\n    it(\"should include service and environment when provided\", async () => {\n      const { getCliFeatureSupport } = await import(\"./version\");\n\n      vi.mocked(getCliFeatureSupport).mockResolvedValue({\n        deployment: {\n          list: true,\n        },\n        logs: {\n          args: {\n            lines: true,\n            filter: true,\n          },\n        },\n      });\n\n      const command = await buildLogCommand({\n        type: \"deployment\",\n        service: \"api\",\n        environment: \"production\",\n        lines: 50,\n      });\n\n      expect(command).toBe(\n        \"railway logs --deployment --lines 50 --service api --environment production\"\n      );\n    });\n\n    it(\"should handle all parameters together\", async () => {\n      const { getCliFeatureSupport } = await import(\"./version\");\n\n      vi.mocked(getCliFeatureSupport).mockResolvedValue({\n        deployment: {\n          list: true,\n        },\n        logs: {\n          args: {\n            lines: true,\n            filter: true,\n          },\n        },\n      });\n\n      const command = await buildLogCommand({\n        type: \"build\",\n        deploymentId: \"deploy-456\",\n        service: \"backend\",\n        environment: \"staging\",\n        lines: 75,\n        filter: \"timeout\",\n      });\n\n      expect(command).toBe(\n        'railway logs --build --lines 75 --filter \"timeout\" deploy-456 --service backend --environment staging'\n      );\n    });\n\n    it(\"should not include --json flag when json is false\", async () => {\n      const { getCliFeatureSupport } = await import(\"./version\");\n\n      vi.mocked(getCliFeatureSupport).mockResolvedValue({\n        deployment: {\n          list: true,\n        },\n        logs: {\n          args: {\n            lines: true,\n            filter: true,\n          },\n        },\n      });\n\n      const command = await buildLogCommand({\n        type: \"deployment\",\n        lines: 100,\n        json: false,\n      });\n\n      expect(command).toBe(\"railway logs --deployment --lines 100\");\n    });\n\n    it(\"should not include --json flag when undefined\", async () => {\n      const { getCliFeatureSupport } = await import(\"./version\");\n\n      vi.mocked(getCliFeatureSupport).mockResolvedValue({\n        deployment: {\n          list: true,\n        },\n        logs: {\n          args: {\n            lines: true,\n            filter: true,\n          },\n        },\n      });\n\n      const command = await buildLogCommand({\n        type: \"deployment\",\n        lines: 100,\n        json: false,\n      });\n\n      expect(command).toBe(\"railway logs --deployment --lines 100\");\n    });\n\n    it(\"should include --json flag when true\", async () => {\n      const { getCliFeatureSupport } = await import(\"./version\");\n\n      vi.mocked(getCliFeatureSupport).mockResolvedValue({\n        deployment: {\n          list: true,\n        },\n        logs: {\n          args: {\n            lines: true,\n            filter: true,\n          },\n        },\n      });\n\n      const command = await buildLogCommand({\n        type: \"deployment\",\n        lines: 100,\n        json: true,\n      });\n\n      expect(command).toBe(\"railway logs --deployment --json --lines 100\");\n    });\n  });\n});\n"],"mappings":"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"}