{"version":3,"file":"version.test.js","names":["expect"],"sources":["../../src/cli/version.test.ts"],"sourcesContent":["import { describe, it, expect, vi, beforeEach } from \"vitest\";\nimport {\n  compareVersions,\n  getRailwayVersion,\n  getCliFeatureSupport,\n  clearVersionCache,\n} from \"./version\";\n\n// Mock the core module\nvi.mock(\"./core\", () => ({\n  runRailwayCommand: vi.fn(),\n}));\n\ndescribe(\"Version Detection\", () => {\n  beforeEach(() => {\n    clearVersionCache();\n    vi.clearAllMocks();\n  });\n\n  describe(\"compareVersions (using semver)\", () => {\n    it(\"should correctly compare version strings\", () => {\n      expect(compareVersions(\"4.9.0\", \"4.9.0\")).toBe(0);\n      expect(compareVersions(\"4.10.0\", \"4.9.0\")).toBe(1);\n      expect(compareVersions(\"4.8.5\", \"4.9.0\")).toBe(-1);\n      expect(compareVersions(\"5.0.0\", \"4.9.0\")).toBe(1);\n      expect(compareVersions(\"4.9.1\", \"4.9.0\")).toBe(1);\n    });\n  });\n\n  describe(\"getRailwayVersion\", () => {\n    it(\"should parse 'railway 4.9.0' format\", async () => {\n      const { runRailwayCommand } = await import(\"./core\");\n      vi.mocked(runRailwayCommand).mockResolvedValueOnce({\n        stdout: \"railway 4.9.0\",\n        stderr: \"\",\n        output: \"railway 4.9.0\",\n      });\n\n      const version = await getRailwayVersion();\n      expect(version).toBe(\"4.9.0\");\n    });\n\n    it(\"should parse 'railway version 4.9.0' format\", async () => {\n      const { runRailwayCommand } = await import(\"./core\");\n      vi.mocked(runRailwayCommand).mockResolvedValueOnce({\n        stdout: \"railway version 4.9.0\",\n        stderr: \"\",\n        output: \"railway version 4.9.0\",\n      });\n\n      const version = await getRailwayVersion();\n      expect(version).toBe(\"4.9.0\");\n    });\n\n    it(\"should parse plain version format\", async () => {\n      const { runRailwayCommand } = await import(\"./core\");\n      vi.mocked(runRailwayCommand).mockResolvedValueOnce({\n        stdout: \"4.9.0\",\n        stderr: \"\",\n        output: \"4.9.0\",\n      });\n\n      const version = await getRailwayVersion();\n      expect(version).toBe(\"4.9.0\");\n    });\n\n    it(\"should return null if unable to parse version\", async () => {\n      const { runRailwayCommand } = await import(\"./core\");\n      vi.mocked(runRailwayCommand).mockResolvedValueOnce({\n        stdout: \"invalid output\",\n        stderr: \"\",\n        output: \"invalid output\",\n      });\n\n      const version = await getRailwayVersion();\n      expect(version).toBe(null);\n    });\n\n    it(\"should return null if command fails\", async () => {\n      const { runRailwayCommand } = await import(\"./core\");\n      vi.mocked(runRailwayCommand).mockRejectedValueOnce(\n        new Error(\"Command failed\")\n      );\n\n      const version = await getRailwayVersion();\n      expect(version).toBe(null);\n    });\n\n    it(\"should use cached version within cache duration\", async () => {\n      const { runRailwayCommand } = await import(\"./core\");\n      vi.mocked(runRailwayCommand).mockResolvedValue({\n        stdout: \"railway 4.9.0\",\n        stderr: \"\",\n        output: \"railway 4.9.0\",\n      });\n\n      const version1 = await getRailwayVersion();\n      expect(version1).toBe(\"4.9.0\");\n      expect(runRailwayCommand).toHaveBeenCalledTimes(1);\n\n      const version2 = await getRailwayVersion();\n      expect(version2).toBe(\"4.9.0\");\n      expect(runRailwayCommand).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe(\"getCliFeatureSupport\", () => {\n    it(\"should return features enabled for version 4.9.0 and above\", async () => {\n      const { runRailwayCommand } = await import(\"./core\");\n\n      vi.mocked(runRailwayCommand).mockResolvedValueOnce({\n        stdout: \"railway 4.8.9\",\n        stderr: \"\",\n        output: \"railway 4.8.9\",\n      });\n      await expect(getCliFeatureSupport()).resolves.toMatchObject({\n        logs: {\n          args: {\n            lines: false,\n            filter: false,\n          },\n        },\n      });\n\n      clearVersionCache();\n      vi.mocked(runRailwayCommand).mockResolvedValueOnce({\n        stdout: \"railway 4.9.0\",\n        stderr: \"\",\n        output: \"railway 4.9.0\",\n      });\n      await expect(getCliFeatureSupport()).resolves.toMatchObject({\n        logs: {\n          args: {\n            lines: true,\n            filter: true,\n          },\n        },\n      });\n    });\n  });\n});\n"],"mappings":"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"}