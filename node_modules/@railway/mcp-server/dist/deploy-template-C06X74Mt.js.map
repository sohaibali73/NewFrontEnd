{"version":3,"file":"deploy-template-C06X74Mt.js","names":["templateToDeploy: Template","error: unknown"],"sources":["../src/tools/deploy-template.ts"],"sourcesContent":["import z from \"zod\";\nimport {\n\tdeployTemplate,\n\tsearchAndListTemplates,\n\ttype Template,\n} from \"../api/deploy-template\";\nimport { getCurrentEnvironmentId } from \"../cli/environments\";\nimport { getLinkedProjectInfo } from \"../cli/projects\";\nimport { createToolResponse } from \"../utils\";\n\ntype DeployTemplateOptions = {\n\tworkspacePath: string;\n\tsearchQuery: string;\n\ttemplateIndex?: number;\n\tteamId?: string;\n};\n\nexport const deployTemplateTool = {\n\tname: \"deploy-template\",\n\ttitle: \"Deploy Railway Template\",\n\tdescription:\n\t\t\"Search and deploy Railway templates. This tool will search for templates using fuzzy search and automatically deploy the selected template to the current Railway project and environment.\",\n\tinputSchema: {\n\t\tworkspacePath: z\n\t\t\t.string()\n\t\t\t.describe(\"The path to the workspace to deploy the template to\"),\n\t\tsearchQuery: z\n\t\t\t.string()\n\t\t\t.describe(\n\t\t\t\t\"Search query to filter templates by name, description, or category\",\n\t\t\t),\n\t\ttemplateIndex: z\n\t\t\t.number()\n\t\t\t.optional()\n\t\t\t.describe(\n\t\t\t\t\"Index of the template to deploy (required if multiple templates found)\",\n\t\t\t),\n\t\tteamId: z.string().optional().describe(\"The ID of the team (optional)\"),\n\t},\n\thandler: async ({\n\t\tworkspacePath,\n\t\tsearchQuery,\n\t\ttemplateIndex,\n\t\tteamId,\n\t}: DeployTemplateOptions) => {\n\t\ttry {\n\t\t\t// Search and list templates\n\t\t\tconst { templates, filteredCount, totalCount } =\n\t\t\t\tawait searchAndListTemplates({ searchQuery });\n\n\t\t\tif (templates.length === 0) {\n\t\t\t\treturn createToolResponse(\n\t\t\t\t\t`üîç No templates found matching \"${searchQuery}\".\\n\\n` +\n\t\t\t\t\t\t`**Total templates available:** ${totalCount}\\n\\n` +\n\t\t\t\t\t\t`**Suggestions:**\\n` +\n\t\t\t\t\t\t`‚Ä¢ Try a different search term\\n` +\n\t\t\t\t\t\t`‚Ä¢ Use broader keywords\\n` +\n\t\t\t\t\t\t`‚Ä¢ Check your internet connection`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// If multiple templates found and no index specified, show the list\n\t\t\tif (templates.length > 1 && templateIndex === undefined) {\n\t\t\t\tconst templateList = templates\n\t\t\t\t\t.map((template: Template, index: number) => {\n\t\t\t\t\t\tconst verifiedBadge = template.isVerified\n\t\t\t\t\t\t\t? \"verified\"\n\t\t\t\t\t\t\t: \"unverified\";\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t`${index + 1}. **${template.name}** - (${verifiedBadge})\\n` +\n\t\t\t\t\t\t\t`   ID: \\`${template.id}\\`\\n` +\n\t\t\t\t\t\t\t`   Description: ${template.description || \"No description available\"}\\n` +\n\t\t\t\t\t\t\t`   Category: ${template.category}\\n` +\n\t\t\t\t\t\t\t`   Active Projects: ${template.activeProjects} | Health: ${template.health} | Payout: ${template.totalPayout}`\n\t\t\t\t\t\t);\n\t\t\t\t\t})\n\t\t\t\t\t.join(\"\\n\\n\");\n\n\t\t\t\treturn createToolResponse(\n\t\t\t\t\t`üîç Multiple templates found matching \"${searchQuery}\":\\n\\n` +\n\t\t\t\t\t\t`**Showing ${filteredCount} of ${totalCount} templates:**\\n\\n` +\n\t\t\t\t\t\ttemplateList +\n\t\t\t\t\t\t`\\n\\n**Please specify which template to deploy by providing:**\\n` +\n\t\t\t\t\t\t`‚Ä¢ templateIndex: [1-${templates.length}]`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Get the template to deploy\n\t\t\tlet templateToDeploy: Template;\n\t\t\tif (templates.length === 1) {\n\t\t\t\ttemplateToDeploy = templates[0];\n\t\t\t} else if (templateIndex !== undefined) {\n\t\t\t\tif (templateIndex < 1 || templateIndex > templates.length) {\n\t\t\t\t\treturn createToolResponse(\n\t\t\t\t\t\t`‚ùå Invalid template index: ${templateIndex}\\n\\n` +\n\t\t\t\t\t\t\t`**Valid range:** 1-${templates.length}\\n\\n` +\n\t\t\t\t\t\t\t`Please provide a valid template index.`,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\ttemplateToDeploy = templates[templateIndex - 1];\n\t\t\t} else {\n\t\t\t\t// This shouldn't happen, but just in case\n\t\t\t\treturn createToolResponse(\n\t\t\t\t\t\"‚ùå Unexpected error: Multiple templates found but no index specified.\",\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Get current project and environment IDs from Railway context\n\t\t\tconst projectResult = await getLinkedProjectInfo({ workspacePath });\n\t\t\tif (!projectResult.success || !projectResult.project) {\n\t\t\t\treturn createToolResponse(\n\t\t\t\t\t\"‚ùå No Railway project is linked to this workspace.\\n\\n\" +\n\t\t\t\t\t\t\"**Next Steps:**\\n\" +\n\t\t\t\t\t\t\"‚Ä¢ Run `railway link` to connect to a project\\n\" +\n\t\t\t\t\t\t\"‚Ä¢ Or use the `create-project-and-link` tool to create a new project\",\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst currentProjectId = projectResult.project.id;\n\t\t\tconst currentEnvironmentId = await getCurrentEnvironmentId({\n\t\t\t\tworkspacePath,\n\t\t\t});\n\n\t\t\t// Deploy the template\n\t\t\tconst result = await deployTemplate({\n\t\t\t\tenvironmentId: currentEnvironmentId,\n\t\t\t\tprojectId: currentProjectId,\n\t\t\t\tserializedConfig: templateToDeploy.serializedConfig,\n\t\t\t\ttemplateId: templateToDeploy.id,\n\t\t\t\tteamId,\n\t\t\t});\n\n\t\t\treturn createToolResponse(\n\t\t\t\t`‚úÖ Successfully deployed Railway template:\\n\\n` +\n\t\t\t\t\t`**Template:** ${templateToDeploy.name}\\n` +\n\t\t\t\t\t`**Template ID:** ${templateToDeploy.id}\\n` +\n\t\t\t\t\t`**Project:** ${projectResult.project.name} (${currentProjectId})\\n` +\n\t\t\t\t\t`**Environment:** ${currentEnvironmentId}\\n` +\n\t\t\t\t\t`**Workflow ID:** ${result.workflowId}\\n\\n` +\n\t\t\t\t\t`The template has been deployed successfully to the current Railway project and environment.`,\n\t\t\t);\n\t\t} catch (error: unknown) {\n\t\t\tconst errorMessage =\n\t\t\t\terror instanceof Error ? error.message : \"Unknown error occurred\";\n\t\t\treturn createToolResponse(\n\t\t\t\t\"‚ùå Failed to search/deploy Railway template\\n\\n\" +\n\t\t\t\t\t`**Error:** ${errorMessage}\\n\\n` +\n\t\t\t\t\t\"**Next Steps:**\\n\" +\n\t\t\t\t\t\"‚Ä¢ Check your internet connection\\n\" +\n\t\t\t\t\t\"‚Ä¢ Verify that Railway's API is accessible\\n\" +\n\t\t\t\t\t\"‚Ä¢ Make sure you're authenticated with Railway (`railway login`)\",\n\t\t\t);\n\t\t}\n\t},\n};\n"],"mappings":";;;;;;;AAiBA,MAAa,qBAAqB;CACjC,MAAM;CACN,OAAO;CACP,aACC;CACD,aAAa;EACZ,eAAe,EACb,QAAQ,CACR,SAAS,sDAAsD;EACjE,aAAa,EACX,QAAQ,CACR,SACA,qEACA;EACF,eAAe,EACb,QAAQ,CACR,UAAU,CACV,SACA,yEACA;EACF,QAAQ,EAAE,QAAQ,CAAC,UAAU,CAAC,SAAS,gCAAgC;EACvE;CACD,SAAS,OAAO,EACf,eACA,aACA,eACA,aAC4B;AAC5B,MAAI;GAEH,MAAM,EAAE,WAAW,eAAe,eACjC,MAAM,uBAAuB,EAAE,aAAa,CAAC;AAE9C,OAAI,UAAU,WAAW,EACxB,QAAO,mBACN,mCAAmC,YAAY,uCACZ,WAAW,+GAK9C;AAIF,OAAI,UAAU,SAAS,KAAK,kBAAkB,QAAW;IACxD,MAAM,eAAe,UACnB,KAAK,UAAoB,UAAkB;KAC3C,MAAM,gBAAgB,SAAS,aAC5B,aACA;AACH,YACC,GAAG,QAAQ,EAAE,MAAM,SAAS,KAAK,QAAQ,cAAc,cAC3C,SAAS,GAAG,sBACL,SAAS,eAAe,2BAA2B,iBACtD,SAAS,SAAS,wBACX,SAAS,eAAe,aAAa,SAAS,OAAO,aAAa,SAAS;MAElG,CACD,KAAK,OAAO;AAEd,WAAO,mBACN,yCAAyC,YAAY,kBACvC,cAAc,MAAM,WAAW,qBAC5C,eACA,sFACuB,UAAU,OAAO,GACzC;;GAIF,IAAIA;AACJ,OAAI,UAAU,WAAW,EACxB,oBAAmB,UAAU;YACnB,kBAAkB,QAAW;AACvC,QAAI,gBAAgB,KAAK,gBAAgB,UAAU,OAClD,QAAO,mBACN,6BAA6B,cAAc,yBACpB,UAAU,OAAO,4CAExC;AAEF,uBAAmB,UAAU,gBAAgB;SAG7C,QAAO,mBACN,uEACA;GAIF,MAAM,gBAAgB,MAAM,qBAAqB,EAAE,eAAe,CAAC;AACnE,OAAI,CAAC,cAAc,WAAW,CAAC,cAAc,QAC5C,QAAO,mBACN,0LAIA;GAGF,MAAM,mBAAmB,cAAc,QAAQ;GAC/C,MAAM,uBAAuB,MAAM,wBAAwB,EAC1D,eACA,CAAC;GAGF,MAAM,SAAS,MAAM,eAAe;IACnC,eAAe;IACf,WAAW;IACX,kBAAkB,iBAAiB;IACnC,YAAY,iBAAiB;IAC7B;IACA,CAAC;AAEF,UAAO,mBACN,8DACkB,iBAAiB,KAAK,qBACnB,iBAAiB,GAAG,iBACxB,cAAc,QAAQ,KAAK,IAAI,iBAAiB,sBAC5C,qBAAqB,qBACrB,OAAO,WAAW,iGAEvC;WACOC,OAAgB;GACxB,MAAM,eACL,iBAAiB,QAAQ,MAAM,UAAU;AAC1C,UAAO,mBACN;;aACe,aAAa;;;mEAK5B;;;CAGH"}