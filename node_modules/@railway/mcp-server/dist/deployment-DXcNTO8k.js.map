{"version":3,"file":"deployment-DXcNTO8k.js","names":["error: unknown"],"sources":["../src/cli/deployment.ts"],"sourcesContent":["import { checkRailwayCliStatus, runRailwayCommand } from \"./core\";\nimport { analyzeRailwayError } from \"./error-handling\";\nimport { getLinkedProjectInfo } from \"./projects\";\nimport { getRailwayServices } from \"./services\";\nimport { getCliFeatureSupport, getRailwayVersion } from \"./version\";\n\nexport type DeployOptions = {\n  workspacePath: string;\n  environment?: string;\n  service?: string;\n  ci?: boolean;\n};\n\nexport const deployRailwayProject = async ({\n  workspacePath,\n  environment,\n  service,\n  ci,\n}: DeployOptions): Promise<string> => {\n  try {\n    await checkRailwayCliStatus();\n    const result = await getLinkedProjectInfo({ workspacePath });\n    if (!result.success) {\n      throw new Error(result.error);\n    }\n\n    // Build the railway up command with options\n    let command = \"railway up\";\n\n    if (ci) {\n      command += \" --ci\";\n    }\n\n    if (environment) {\n      command += ` --environment ${environment}`;\n    }\n\n    if (service) {\n      command += ` --service ${service}`;\n    }\n\n    const { output: deployOutput } = await runRailwayCommand(\n      command,\n      workspacePath\n    );\n\n    // After deployment, try to link a service if none is linked\n    try {\n      // Check if there are any services available\n      const servicesResult = await getRailwayServices({ workspacePath });\n      if (\n        servicesResult.success &&\n        servicesResult.services &&\n        servicesResult.services.length > 0\n      ) {\n        // Link the first available service\n        const firstService = servicesResult.services[0];\n        const { output: linkOutput } = await runRailwayCommand(\n          `railway service ${firstService}`,\n          workspacePath\n        );\n        return `${deployOutput}\\n\\nService linked: ${firstService}\\n${linkOutput}`;\n      }\n    } catch (linkError) {\n      // If linking fails, just return the deployment output\n      console.warn(\n        \"Warning: Could not automatically link service after deployment:\",\n        linkError\n      );\n    }\n\n    return deployOutput;\n  } catch (error: unknown) {\n    return analyzeRailwayError(error, \"railway up\");\n  }\n};\n\nexport type ListDeploymentsOptions = {\n  workspacePath: string;\n  service?: string;\n  environment?: string;\n  limit?: number;\n  json?: boolean;\n};\n\nexport type Deployment = {\n  id: string;\n  status: string;\n  createdAt: string;\n  commitMessage?: string;\n  commitAuthor?: string;\n  branch?: string;\n  serviceName?: string;\n  environmentName?: string;\n};\n\nexport const listDeployments = async ({\n  workspacePath,\n  service,\n  environment,\n  limit = 20,\n  json = false,\n}: ListDeploymentsOptions): Promise<\n  | {\n      success: true;\n      output: string;\n    }\n  | {\n      success: false;\n      error: string;\n    }\n> => {\n  try {\n    await checkRailwayCliStatus();\n\n    const featureSupport = await getCliFeatureSupport();\n    if (!featureSupport.deployment.list) {\n      const version = await getRailwayVersion();\n      return {\n        success: false,\n        error: `Railway CLI version ${\n          version || \"unknown\"\n        } does not support 'deployment list' command. Please upgrade to version 4.10.0 or later.`,\n      };\n    }\n\n    const projectResult = await getLinkedProjectInfo({ workspacePath });\n    if (!projectResult.success) {\n      return {\n        success: false,\n        error: projectResult.error ?? \"Failed to get project info\",\n      };\n    }\n\n    let command = \"railway deployment list\";\n\n    if (service) {\n      command += ` --service ${service}`;\n    }\n\n    if (environment) {\n      command += ` --environment ${environment}`;\n    }\n\n    if (limit) {\n      command += ` --limit ${limit}`;\n    }\n\n    if (json) {\n      command += \" --json\";\n    }\n\n    const { output } = await runRailwayCommand(command, workspacePath);\n    return { success: true, output };\n  } catch (error: unknown) {\n    return analyzeRailwayError(error, `railway deployment list`);\n  }\n};\n"],"mappings":";;;;;;;AAaA,MAAa,uBAAuB,OAAO,EACzC,eACA,aACA,SACA,SACoC;AACpC,KAAI;AACF,QAAM,uBAAuB;EAC7B,MAAM,SAAS,MAAM,qBAAqB,EAAE,eAAe,CAAC;AAC5D,MAAI,CAAC,OAAO,QACV,OAAM,IAAI,MAAM,OAAO,MAAM;EAI/B,IAAI,UAAU;AAEd,MAAI,GACF,YAAW;AAGb,MAAI,YACF,YAAW,kBAAkB;AAG/B,MAAI,QACF,YAAW,cAAc;EAG3B,MAAM,EAAE,QAAQ,iBAAiB,MAAM,kBACrC,SACA,cACD;AAGD,MAAI;GAEF,MAAM,iBAAiB,MAAM,mBAAmB,EAAE,eAAe,CAAC;AAClE,OACE,eAAe,WACf,eAAe,YACf,eAAe,SAAS,SAAS,GACjC;IAEA,MAAM,eAAe,eAAe,SAAS;IAC7C,MAAM,EAAE,QAAQ,eAAe,MAAM,kBACnC,mBAAmB,gBACnB,cACD;AACD,WAAO,GAAG,aAAa,sBAAsB,aAAa,IAAI;;WAEzD,WAAW;AAElB,WAAQ,KACN,mEACA,UACD;;AAGH,SAAO;UACAA,OAAgB;AACvB,SAAO,oBAAoB,OAAO,aAAa;;;AAuBnD,MAAa,kBAAkB,OAAO,EACpC,eACA,SACA,aACA,QAAQ,IACR,OAAO,YAUJ;AACH,KAAI;AACF,QAAM,uBAAuB;AAG7B,MAAI,EADmB,MAAM,sBAAsB,EAC/B,WAAW,KAE7B,QAAO;GACL,SAAS;GACT,OAAO,uBAHO,MAAM,mBAAmB,IAI1B,UACZ;GACF;EAGH,MAAM,gBAAgB,MAAM,qBAAqB,EAAE,eAAe,CAAC;AACnE,MAAI,CAAC,cAAc,QACjB,QAAO;GACL,SAAS;GACT,OAAO,cAAc,SAAS;GAC/B;EAGH,IAAI,UAAU;AAEd,MAAI,QACF,YAAW,cAAc;AAG3B,MAAI,YACF,YAAW,kBAAkB;AAG/B,MAAI,MACF,YAAW,YAAY;AAGzB,MAAI,KACF,YAAW;EAGb,MAAM,EAAE,WAAW,MAAM,kBAAkB,SAAS,cAAc;AAClE,SAAO;GAAE,SAAS;GAAM;GAAQ;UACzBA,OAAgB;AACvB,SAAO,oBAAoB,OAAO,0BAA0B"}