{"version":3,"file":"environments-BMQ5EW9R.js","names":["error: unknown"],"sources":["../src/cli/environments.ts"],"sourcesContent":["import {\n\tcheckRailwayCliStatus,\n\trunRailwayCommand,\n\trunRailwayJsonCommand,\n} from \"./core\";\nimport { analyzeRailwayError } from \"./error-handling\";\nimport { getLinkedProjectInfo } from \"./projects\";\n\nexport type GetCurrentEnvironmentIdOptions = {\n\tworkspacePath: string;\n};\n\nexport const getCurrentEnvironmentId = async ({\n\tworkspacePath,\n}: GetCurrentEnvironmentIdOptions): Promise<string> => {\n\ttry {\n\t\tawait checkRailwayCliStatus();\n\t\tconst result = await getLinkedProjectInfo({ workspacePath });\n\t\tif (!result.success) {\n\t\t\tthrow new Error(result.error);\n\t\t}\n\n\t\t// First, get the current environment name from railway status\n\t\tconst { output: statusOutput } = await runRailwayCommand(\n\t\t\t\"railway status\",\n\t\t\tworkspacePath,\n\t\t);\n\n\t\t// Parse the output to extract current environment name\n\t\t// The output format is typically: \"Environment: production\"\n\t\tconst envNameMatch = statusOutput.match(/Environment:\\s+(\\w+)/);\n\t\tif (!envNameMatch?.[1]) {\n\t\t\tthrow new Error(\"Could not determine current environment name\");\n\t\t}\n\n\t\tconst currentEnvironmentName = envNameMatch[1];\n\n\t\t// Get detailed environment information using railway status --json\n\t\tconst statusData = await runRailwayJsonCommand(\n\t\t\t\"railway status --json\",\n\t\t\tworkspacePath,\n\t\t);\n\n\t\t// Find the environment ID that matches the current environment name\n\t\tif (statusData.environments?.edges?.length > 0) {\n\t\t\tfor (const envEdge of statusData.environments.edges) {\n\t\t\t\tconst env = envEdge.node;\n\t\t\t\tif (env.name === currentEnvironmentName) {\n\t\t\t\t\treturn env.id;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// If we can't find the environment ID, throw an error\n\t\tthrow new Error(\n\t\t\t`Could not determine environment ID for environment: ${currentEnvironmentName}`,\n\t\t);\n\t} catch (error: unknown) {\n\t\treturn analyzeRailwayError(error, \"railway environment\");\n\t}\n};\n\nexport type LinkEnvironmentOptions = {\n\tworkspacePath: string;\n\tenvironmentName?: string;\n};\n\nexport const linkRailwayEnvironment = async ({\n\tworkspacePath,\n\tenvironmentName,\n}: LinkEnvironmentOptions): Promise<string> => {\n\ttry {\n\t\tawait checkRailwayCliStatus();\n\t\tconst result = await getLinkedProjectInfo({ workspacePath });\n\t\tif (!result.success) {\n\t\t\tthrow new Error(result.error);\n\t\t}\n\n\t\tconst command = environmentName\n\t\t\t? `railway environment ${environmentName}`\n\t\t\t: \"railway environment\";\n\t\tconst { output } = await runRailwayCommand(command, workspacePath);\n\n\t\treturn output;\n\t} catch (error: unknown) {\n\t\treturn analyzeRailwayError(error, \"railway environment\");\n\t}\n};\n\nexport type CreateEnvironmentOptions = {\n\tworkspacePath: string;\n\tenvironmentName: string;\n\tduplicateEnvironment?: string;\n\tserviceVariables?: Array<{ service: string; variable: string }>;\n};\n\nexport const createRailwayEnvironment = async ({\n\tworkspacePath,\n\tenvironmentName,\n\tduplicateEnvironment,\n\tserviceVariables,\n}: CreateEnvironmentOptions): Promise<string> => {\n\ttry {\n\t\tawait checkRailwayCliStatus();\n\t\tconst result = await getLinkedProjectInfo({ workspacePath });\n\t\tif (!result.success) {\n\t\t\tthrow new Error(result.error);\n\t\t}\n\n\t\tlet command = `railway environment new ${environmentName}`;\n\n\t\tif (duplicateEnvironment) {\n\t\t\tcommand += ` --duplicate ${duplicateEnvironment}`;\n\t\t}\n\n\t\tif (serviceVariables && serviceVariables.length > 0) {\n\t\t\tfor (const sv of serviceVariables) {\n\t\t\t\tcommand += ` --service-variable ${sv.service} ${sv.variable}`;\n\t\t\t}\n\t\t}\n\n\t\tconst { output } = await runRailwayCommand(command, workspacePath);\n\n\t\treturn output;\n\t} catch (error: unknown) {\n\t\treturn analyzeRailwayError(\n\t\t\terror,\n\t\t\t`railway environment new ${environmentName}`,\n\t\t);\n\t}\n};\n"],"mappings":";;;;;AAYA,MAAa,0BAA0B,OAAO,EAC7C,oBACsD;AACtD,KAAI;AACH,QAAM,uBAAuB;EAC7B,MAAM,SAAS,MAAM,qBAAqB,EAAE,eAAe,CAAC;AAC5D,MAAI,CAAC,OAAO,QACX,OAAM,IAAI,MAAM,OAAO,MAAM;EAI9B,MAAM,EAAE,QAAQ,iBAAiB,MAAM,kBACtC,kBACA,cACA;EAID,MAAM,eAAe,aAAa,MAAM,uBAAuB;AAC/D,MAAI,CAAC,eAAe,GACnB,OAAM,IAAI,MAAM,+CAA+C;EAGhE,MAAM,yBAAyB,aAAa;EAG5C,MAAM,aAAa,MAAM,sBACxB,yBACA,cACA;AAGD,MAAI,WAAW,cAAc,OAAO,SAAS,EAC5C,MAAK,MAAM,WAAW,WAAW,aAAa,OAAO;GACpD,MAAM,MAAM,QAAQ;AACpB,OAAI,IAAI,SAAS,uBAChB,QAAO,IAAI;;AAMd,QAAM,IAAI,MACT,uDAAuD,yBACvD;UACOA,OAAgB;AACxB,SAAO,oBAAoB,OAAO,sBAAsB;;;AAS1D,MAAa,yBAAyB,OAAO,EAC5C,eACA,sBAC8C;AAC9C,KAAI;AACH,QAAM,uBAAuB;EAC7B,MAAM,SAAS,MAAM,qBAAqB,EAAE,eAAe,CAAC;AAC5D,MAAI,CAAC,OAAO,QACX,OAAM,IAAI,MAAM,OAAO,MAAM;EAG9B,MAAM,UAAU,kBACb,uBAAuB,oBACvB;EACH,MAAM,EAAE,WAAW,MAAM,kBAAkB,SAAS,cAAc;AAElE,SAAO;UACCA,OAAgB;AACxB,SAAO,oBAAoB,OAAO,sBAAsB;;;AAW1D,MAAa,2BAA2B,OAAO,EAC9C,eACA,iBACA,sBACA,uBACgD;AAChD,KAAI;AACH,QAAM,uBAAuB;EAC7B,MAAM,SAAS,MAAM,qBAAqB,EAAE,eAAe,CAAC;AAC5D,MAAI,CAAC,OAAO,QACX,OAAM,IAAI,MAAM,OAAO,MAAM;EAG9B,IAAI,UAAU,2BAA2B;AAEzC,MAAI,qBACH,YAAW,gBAAgB;AAG5B,MAAI,oBAAoB,iBAAiB,SAAS,EACjD,MAAK,MAAM,MAAM,iBAChB,YAAW,uBAAuB,GAAG,QAAQ,GAAG,GAAG;EAIrD,MAAM,EAAE,WAAW,MAAM,kBAAkB,SAAS,cAAc;AAElE,SAAO;UACCA,OAAgB;AACxB,SAAO,oBACN,OACA,2BAA2B,kBAC3B"}