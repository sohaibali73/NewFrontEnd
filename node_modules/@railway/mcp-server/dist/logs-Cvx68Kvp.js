import { analyzeRailwayError } from "./error-handling-mxVa5oOu.js";
import { checkRailwayCliStatus, runRailwayCommand } from "./core-BMlc7cvF.js";
import { getLinkedProjectInfo } from "./projects-ENU6yIz7.js";
import { getCliFeatureSupport } from "./version-BriONvFH.js";

//#region src/cli/logs.ts
const buildLogCommand = async ({ type, deploymentId, service, environment, lines, filter, json = false }) => {
	const args = ["logs", `--${type}`];
	if (json) args.push("--json");
	const features = await getCliFeatureSupport();
	if (features.logs.args.lines && features.logs.args.filter) {
		const defaultLines = json ? "100" : "500";
		args.push("--lines", lines ? lines.toString() : defaultLines);
		if (filter) args.push("--filter", `"${filter}"`);
	}
	if (deploymentId) args.push(deploymentId);
	if (service) args.push("--service", service);
	if (environment) args.push("--environment", environment);
	return `railway ${args.join(" ")}`;
};
const getRailwayDeployLogs = async ({ workspacePath, deploymentId, service, environment, lines, filter, json }) => {
	const command = await buildLogCommand({
		type: "deployment",
		deploymentId,
		service,
		environment,
		lines,
		filter,
		json
	});
	try {
		await checkRailwayCliStatus();
		const result = await getLinkedProjectInfo({ workspacePath });
		if (!result.success) throw new Error(result.error);
		const { output } = await runRailwayCommand(command, workspacePath);
		return output;
	} catch (error) {
		return analyzeRailwayError(error, command);
	}
};
const getRailwayBuildLogs = async ({ workspacePath, deploymentId, service, environment, lines, filter, json }) => {
	const command = await buildLogCommand({
		type: "build",
		deploymentId,
		service,
		environment,
		lines,
		filter,
		json
	});
	try {
		await checkRailwayCliStatus();
		const result = await getLinkedProjectInfo({ workspacePath });
		if (!result.success) throw new Error(result.error);
		const { output } = await runRailwayCommand(command, workspacePath);
		return output;
	} catch (error) {
		return analyzeRailwayError(error, command);
	}
};

//#endregion
export { buildLogCommand, getRailwayBuildLogs, getRailwayDeployLogs };
//# sourceMappingURL=logs-Cvx68Kvp.js.map