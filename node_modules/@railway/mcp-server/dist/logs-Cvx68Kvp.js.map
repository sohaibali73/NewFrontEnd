{"version":3,"file":"logs-Cvx68Kvp.js","names":["error: unknown"],"sources":["../src/cli/logs.ts"],"sourcesContent":["import { checkRailwayCliStatus, runRailwayCommand } from \"./core\";\nimport { getCliFeatureSupport } from \"./version\";\nimport { analyzeRailwayError } from \"./error-handling\";\nimport { getLinkedProjectInfo } from \"./projects\";\n\ntype BuildLogCommandOptions = {\n  type: \"deployment\" | \"build\";\n  deploymentId?: string;\n  service?: string;\n  environment?: string;\n  lines?: number;\n  filter?: string;\n  json?: boolean;\n};\n\nexport const buildLogCommand = async ({\n  type,\n  deploymentId,\n  service,\n  environment,\n  lines,\n  filter,\n  json = false,\n}: BuildLogCommandOptions): Promise<string> => {\n  const args = [\"logs\", `--${type}`];\n  if (json) {\n    args.push(\"--json\");\n  }\n\n  const features = await getCliFeatureSupport();\n  const supportsLinesAndFilter =\n    features.logs.args.lines && features.logs.args.filter;\n\n  if (supportsLinesAndFilter) {\n    // JSON really eats the token limit up, so default to a low amount if that's\n    // turned on.\n    const defaultLines = json ? \"100\" : \"500\";\n\n    // Always use --lines when specified to prevent streaming\n    args.push(\"--lines\", lines ? lines.toString() : defaultLines);\n\n    if (filter) {\n      args.push(\"--filter\", `\"${filter}\"`);\n    }\n  }\n\n  if (deploymentId) args.push(deploymentId);\n  if (service) args.push(\"--service\", service);\n  if (environment) args.push(\"--environment\", environment);\n\n  return `railway ${args.join(\" \")}`;\n};\n\nexport type GetLogsOptions = Pick<\n  BuildLogCommandOptions,\n  \"deploymentId\" | \"service\" | \"environment\" | \"lines\" | \"filter\" | \"json\"\n> & {\n  workspacePath: string;\n};\n\nexport const getRailwayDeployLogs = async ({\n  workspacePath,\n  deploymentId,\n  service,\n  environment,\n  lines,\n  filter,\n  json,\n}: GetLogsOptions): Promise<string> => {\n  const command = await buildLogCommand({\n    type: \"deployment\",\n    deploymentId,\n    service,\n    environment,\n    lines,\n    filter,\n    json,\n  });\n\n  try {\n    await checkRailwayCliStatus();\n    const result = await getLinkedProjectInfo({ workspacePath });\n    if (!result.success) {\n      throw new Error(result.error);\n    }\n\n    const { output } = await runRailwayCommand(command, workspacePath);\n\n    return output;\n  } catch (error: unknown) {\n    return analyzeRailwayError(error, command);\n  }\n};\n\nexport const getRailwayBuildLogs = async ({\n  workspacePath,\n  deploymentId,\n  service,\n  environment,\n  lines,\n  filter,\n  json,\n}: GetLogsOptions): Promise<string> => {\n  const command = await buildLogCommand({\n    type: \"build\",\n    deploymentId,\n    service,\n    environment,\n    lines,\n    filter,\n    json,\n  });\n  try {\n    await checkRailwayCliStatus();\n    const result = await getLinkedProjectInfo({ workspacePath });\n    if (!result.success) {\n      throw new Error(result.error);\n    }\n\n    const { output } = await runRailwayCommand(command, workspacePath);\n\n    return output;\n  } catch (error: unknown) {\n    return analyzeRailwayError(error, command);\n  }\n};\n"],"mappings":";;;;;;AAeA,MAAa,kBAAkB,OAAO,EACpC,MACA,cACA,SACA,aACA,OACA,QACA,OAAO,YACsC;CAC7C,MAAM,OAAO,CAAC,QAAQ,KAAK,OAAO;AAClC,KAAI,KACF,MAAK,KAAK,SAAS;CAGrB,MAAM,WAAW,MAAM,sBAAsB;AAI7C,KAFE,SAAS,KAAK,KAAK,SAAS,SAAS,KAAK,KAAK,QAErB;EAG1B,MAAM,eAAe,OAAO,QAAQ;AAGpC,OAAK,KAAK,WAAW,QAAQ,MAAM,UAAU,GAAG,aAAa;AAE7D,MAAI,OACF,MAAK,KAAK,YAAY,IAAI,OAAO,GAAG;;AAIxC,KAAI,aAAc,MAAK,KAAK,aAAa;AACzC,KAAI,QAAS,MAAK,KAAK,aAAa,QAAQ;AAC5C,KAAI,YAAa,MAAK,KAAK,iBAAiB,YAAY;AAExD,QAAO,WAAW,KAAK,KAAK,IAAI;;AAUlC,MAAa,uBAAuB,OAAO,EACzC,eACA,cACA,SACA,aACA,OACA,QACA,WACqC;CACrC,MAAM,UAAU,MAAM,gBAAgB;EACpC,MAAM;EACN;EACA;EACA;EACA;EACA;EACA;EACD,CAAC;AAEF,KAAI;AACF,QAAM,uBAAuB;EAC7B,MAAM,SAAS,MAAM,qBAAqB,EAAE,eAAe,CAAC;AAC5D,MAAI,CAAC,OAAO,QACV,OAAM,IAAI,MAAM,OAAO,MAAM;EAG/B,MAAM,EAAE,WAAW,MAAM,kBAAkB,SAAS,cAAc;AAElE,SAAO;UACAA,OAAgB;AACvB,SAAO,oBAAoB,OAAO,QAAQ;;;AAI9C,MAAa,sBAAsB,OAAO,EACxC,eACA,cACA,SACA,aACA,OACA,QACA,WACqC;CACrC,MAAM,UAAU,MAAM,gBAAgB;EACpC,MAAM;EACN;EACA;EACA;EACA;EACA;EACA;EACD,CAAC;AACF,KAAI;AACF,QAAM,uBAAuB;EAC7B,MAAM,SAAS,MAAM,qBAAqB,EAAE,eAAe,CAAC;AAC5D,MAAI,CAAC,OAAO,QACV,OAAM,IAAI,MAAM,OAAO,MAAM;EAG/B,MAAM,EAAE,WAAW,MAAM,kBAAkB,SAAS,cAAc;AAElE,SAAO;UACAA,OAAgB;AACvB,SAAO,oBAAoB,OAAO,QAAQ"}