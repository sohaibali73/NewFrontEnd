import { ERROR_PATTERNS, analyzeRailwayError } from "./error-handling-mxVa5oOu.js";
import { checkRailwayCliStatus, runRailwayCommand, runRailwayJsonCommand } from "./core-BMlc7cvF.js";

//#region src/cli/projects.ts
const getLinkedProjectInfo = async ({ workspacePath }) => {
	try {
		await checkRailwayCliStatus();
		const project = await runRailwayJsonCommand("railway status --json", workspacePath);
		if (!project || typeof project !== "object") return {
			success: false,
			error: "Invalid response from Railway CLI"
		};
		return {
			success: true,
			project
		};
	} catch (error) {
		const errorMessage = error instanceof Error ? error.message : String(error);
		if (ERROR_PATTERNS.NO_LINKED_PROJECT.test(errorMessage)) return {
			success: false,
			error: "No Railway project is linked. Run 'railway link' to connect to a project"
		};
		return {
			success: false,
			error: errorMessage
		};
	}
};
const listRailwayProjects = async () => {
	try {
		await checkRailwayCliStatus();
		const projects = await runRailwayJsonCommand("railway list --json");
		if (!Array.isArray(projects)) throw new Error("Unexpected response format from Railway CLI");
		return projects;
	} catch (error) {
		return analyzeRailwayError(error, "railway list --json");
	}
};
const createRailwayProject = async ({ projectName, workspacePath }) => {
	try {
		await checkRailwayCliStatus();
		const linkedProjectResult = await getLinkedProjectInfo({ workspacePath });
		if (linkedProjectResult.success && linkedProjectResult.project) return "A Railway project is already linked to this workspace. No new project created.";
		const { output: initOutput } = await runRailwayCommand(`railway init --name ${projectName}`, workspacePath);
		const { output: linkOutput } = await runRailwayCommand(`railway link -p ${projectName}`, workspacePath);
		return `${initOutput}\n${linkOutput}`;
	} catch (error) {
		return analyzeRailwayError(error, `railway init --name ${projectName}`);
	}
};

//#endregion
export { createRailwayProject, getLinkedProjectInfo, listRailwayProjects };
//# sourceMappingURL=projects-ENU6yIz7.js.map