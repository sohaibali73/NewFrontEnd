{"version":3,"file":"version-BriONvFH.js","names":["cachedVersion: string | null","versionCacheTime: number | null"],"sources":["../src/cli/version.ts"],"sourcesContent":["import * as semver from \"semver\";\nimport { runRailwayCommand } from \"./core\";\n\nlet cachedVersion: string | null = null;\nlet versionCacheTime: number | null = null;\nconst VERSION_CACHE_DURATION = 5 * 60 * 1000;\n\n/**\n * Get the Railway CLI version\n * @returns Version string (e.g., \"4.9.0\") or null if unable to determine\n */\nexport const getRailwayVersion = async (): Promise<string | null> => {\n  // Use a cache to avoid constantly running railway --version.\n  if (\n    cachedVersion &&\n    versionCacheTime &&\n    Date.now() - versionCacheTime < VERSION_CACHE_DURATION\n  ) {\n    return cachedVersion;\n  }\n\n  try {\n    const { stdout } = await runRailwayCommand(\"railway --version\");\n    // Use semver.coerce to extract a valid semver from various formats\n    // This handles \"railway 4.9.0\", \"railway version 4.9.0\", \"4.9.0\", etc.\n    const version = semver.coerce(stdout);\n    if (version) {\n      cachedVersion = version.version;\n      versionCacheTime = Date.now();\n      return cachedVersion;\n    }\n  } catch (_error) {\n    // Unable to determine version\n  }\n\n  return null;\n};\n\n/** Clear the cached version  */\nexport const clearVersionCache = (): void => {\n  cachedVersion = null;\n  versionCacheTime = null;\n};\n\n/**Force a fresh version check */\nexport const refreshRailwayVersion = async (): Promise<string | null> => {\n  clearVersionCache();\n  return getRailwayVersion();\n};\n\n/**\n * Compare version strings using semver\n * @returns 1 if version1 > version2, -1 if version1 < version2, 0 if equal\n */\nexport const compareVersions = (version1: string, version2: string): number => {\n  return semver.compare(version1, version2);\n};\n\nexport type CliFeatureSupport = {\n  logs: {\n    args: {\n      lines: boolean;\n      filter: boolean;\n    };\n  };\n  deployment: {\n    list: boolean;\n  };\n};\n\n/** Get Railway CLI feature support based on version */\nexport const getCliFeatureSupport = async (): Promise<CliFeatureSupport> => {\n  const version = await getRailwayVersion();\n\n  const supportsLogFeatures = version ? semver.gte(version, \"4.9.0\") : false;\n  const supportsDeploymentList = version ? semver.gte(version, \"4.10.0\") : false;\n\n  return {\n    logs: {\n      args: {\n        lines: supportsLogFeatures,\n        filter: supportsLogFeatures,\n      },\n    },\n    deployment: {\n      list: supportsDeploymentList,\n    },\n  };\n};\n"],"mappings":";;;;AAGA,IAAIA,gBAA+B;AACnC,IAAIC,mBAAkC;AACtC,MAAM,yBAAyB,MAAS;;;;;AAMxC,MAAa,oBAAoB,YAAoC;AAEnE,KACE,iBACA,oBACA,KAAK,KAAK,GAAG,mBAAmB,uBAEhC,QAAO;AAGT,KAAI;EACF,MAAM,EAAE,WAAW,MAAM,kBAAkB,oBAAoB;EAG/D,MAAM,UAAU,OAAO,OAAO,OAAO;AACrC,MAAI,SAAS;AACX,mBAAgB,QAAQ;AACxB,sBAAmB,KAAK,KAAK;AAC7B,UAAO;;UAEF,QAAQ;AAIjB,QAAO;;;AAIT,MAAa,0BAAgC;AAC3C,iBAAgB;AAChB,oBAAmB;;;AAIrB,MAAa,wBAAwB,YAAoC;AACvE,oBAAmB;AACnB,QAAO,mBAAmB;;;;;;AAO5B,MAAa,mBAAmB,UAAkB,aAA6B;AAC7E,QAAO,OAAO,QAAQ,UAAU,SAAS;;;AAgB3C,MAAa,uBAAuB,YAAwC;CAC1E,MAAM,UAAU,MAAM,mBAAmB;CAEzC,MAAM,sBAAsB,UAAU,OAAO,IAAI,SAAS,QAAQ,GAAG;CACrE,MAAM,yBAAyB,UAAU,OAAO,IAAI,SAAS,SAAS,GAAG;AAEzE,QAAO;EACL,MAAM,EACJ,MAAM;GACJ,OAAO;GACP,QAAQ;GACT,EACF;EACD,YAAY,EACV,MAAM,wBACP;EACF"}